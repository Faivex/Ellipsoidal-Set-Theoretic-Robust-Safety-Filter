# Ellipsoidal Set-Theoretic Robust Safety Filter

This repository provides MATLAB implementations of robust safety filters for constrained linear systems, as presented in our paper "Ellipsoidal Set-Theoretic Design of Robust Safety Filters for Constrained Linear Systems."

## Overview

Safety filters are supervisory control mechanisms that ensure safety-critical constraints are satisfied while minimally interfering with nominal controller performance. This implementation demonstrates an ellipsoidal set-theoretic approach for synthesizing robust safety filters that:

- Compute robust controlled invariant (RCI) ellipsoidal sets via convex LMI optimization
- Provide formal safety guarantees under bounded disturbances
- Enable smooth transitions between nominal and backup controllers
- Scale efficiently to high-dimensional systems

The method is validated on a 6-DOF quadrotor system with hierarchical position-attitude control under wind disturbances.

## Key Features

- **Convex Optimization Framework**: LMI-based synthesis ensuring global optimality
- **Robust Disturbance Rejection**: Handles bounded additive disturbances with formal guarantees
- **Constraint Satisfaction**: Enforces state, input, and output constraints
- **Minimal Intervention**: Smooth distance-based blending between nominal and backup controllers
- **Nonlinear Extension**: Handles nonlinear systems via linearization with rigorous error bounds

## Files Description

### Main Simulation Scripts
- `quadrotorScenario_I.m` - Nominal operation with small position errors
- `quadrotorScenario_II.m` - Large initial position errors requiring safety intervention
- `quadrotorScenario_III.m` - Aggressive high-frequency circular trajectory tracking

### Core Functions
- `loadSystemParameters.m` - Quadrotor parameters (mass, inertia, etc.) for Crazyflie 2.0
- `defineEquilibriumPoint.m` - Hover equilibrium point calculation
- `linearizeModel.m` - Attitude dynamics linearization around equilibrium
- `robustControlDesign.m` - LMI-based RCI set and backup controller synthesis
- `computeAttitudeLinearizationErrorBound.m` - Rigorous linearization error bounds
- `plotResults.m` - Comparative visualization of safe vs. unsafe scenarios
- `formatFigureIEEE.m` - IEEE-standard figure formatting for publication

## Mathematical Framework

The safety filter is designed for linear systems with bounded disturbances:
```
ẋ = Ax + Bu + Ed,  ||d|| ≤ 1
```

The synthesis solves a convex optimization problem to simultaneously compute:
1. Ellipsoidal RCI set ℰ(P) = {x : x^T P x ≤ 1}
2. Stabilizing feedback gain K
3. Maximum volume subject to state/input constraints

The filtered control law smoothly blends nominal and backup controllers:
```
u_s = (1 - α(x))u_nom + α(x)Kx
```
where α(x) is a mixing function based on distance to the set boundary.

## Usage

1. **Run a simulation scenario**:
```matlab
   quadrotorScenario_II  % Large position errors scenario
```

2. **The simulation pipeline**:
   - Loads Crazyflie 2.0 quadrotor parameters
   - Linearizes attitude dynamics around hover
   - Designs robust safety filter via LMI optimization
   - Simulates closed-loop system with/without safety filter
   - Generates comparative plots showing safety guarantees

3. **Key parameters** (configurable in scenario scripts):
   - Roll/pitch constraints: |φ|, |θ| ≤ 40°
   - Torque limits: |τ_i| ≤ 1×10⁻⁴ N·m
   - Disturbance bound: ||d|| ≤ 1×10⁻⁵ N·m
   - Mixing function thresholds: h_min = 0.1, h_max = 0.9

## Requirements

- MATLAB R2020a or later
- [CVX](http://cvxr.com/cvx/) - Convex optimization toolbox
- [MOSEK](https://www.mosek.com/) or SeDuMi - SDP solver
- Control System Toolbox

### Installation
1. Install CVX from http://cvxr.com/cvx/download/
2. Install MOSEK solver (academic license available)
3. Add CVX to MATLAB path:
```matlab
   addpath('path/to/cvx')
   cvx_setup
```

## Simulation Results

The three scenarios demonstrate:

**Scenario I**: Minimal intervention during safe operation (h ≪ 1)
- Safety filter remains inactive
- Nominal performance preserved

**Scenario II**: Prevention of instability from large position errors
- Without filter: Roll/pitch constraints violated → instability
- With filter: Smooth intervention maintains safety and stability

**Scenario III**: Robust tracking under aggressive circular trajectory
- Without filter: System becomes unstable
- With filter: Stable circular-like trajectory maintained

All scenarios include wind disturbances: d(t) = [sin(2t), cos(2t), 0]^T

## Citation

If you use this code in your research, please cite:
```bibtex
@inproceedings{pordal2025ellipsoidal,
  title={Ellipsoidal Set-Theoretic Design of Robust Safety Filters for Constrained Linear Systems},
  author={Pordal, Reza and Sharifi, Alireza and Baniasad, Ali},
  booktitle={IEEE Conference},
  year={2025},
  organization={IEEE}
}
```

## Theoretical Background

The approach builds on:
- **Nagumo's Theorem**: Characterizes set invariance via tangent cones
- **S-Procedure**: Converts semi-infinite constraints to finite LMIs
- **Set-Theoretic Control**: Computes maximal safe operating regions
- **Viability Theory**: Ensures state trajectories remain in safe sets

See the paper for detailed proofs and theoretical foundations.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Acknowledgments

Quadrotor parameters based on the Crazyflie 2.0 nano quadrotor platform [1].

[1] Forster et al., "System identification of the Crazyflie 2.0 nano quadrotor," 2015.

## Contact

**Reza Pordal**  
Department of Aerospace Engineering  
Sharif University of Technology  
Email: reza.p@ae.sharif.edu

**Repository**: https://github.com/Faivex/Ellipsoidal-Set-Theoretic-Robust-Safety-Filter

---

For questions, issues, or contributions, please open an issue on GitHub.